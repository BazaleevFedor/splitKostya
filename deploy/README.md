# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –¥–ª—è SplitKostya

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ VPS –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ –≤–µ—Ç–∫—É `main`.

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü—Ä–∏ –ª—é–±–æ–º push –≤ –ª—é–±—É—é –≤–µ—Ç–∫—É:
1. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–∏–Ω—Ç–µ—Ä (ESLint)
2. ‚úÖ –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã (Karma + Jasmine)
3. ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç (Angular build)
4. ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç—Å—è production –≤–µ—Ä—Å–∏—è

### –ü—Ä–∏ merge –≤ main (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ):
1. üîÑ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã—à–µ
2. üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ VPS
3. üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–í –≤–∞—à–µ–º GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí Secrets and variables ‚Üí Actions** –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

- `VPS_HOST` - IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ VPS
- `VPS_USERNAME` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH (–æ–±—ã—á–Ω–æ `www-data`)
- `VPS_SSH_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPS
- `VPS_PORT` - SSH –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ `22`)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPS

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VPS –ø–æ SSH

```bash
ssh username@your-vps-ip
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª—ã –¥–µ–ø–ª–æ—è
git clone https://github.com/your-username/splitKostya.git
cd splitKostya/deploy

# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x setup-vps.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É (—Ç—Ä–µ–±—É–µ—Ç sudo)
sudo ./setup-vps.sh
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/nginx/sites-available/splitkostya` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `your-domain.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω.

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx

```bash
sudo systemctl restart nginx
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è –Ω–∞ VPS

```
/var/www/splitKostya/
‚îú‚îÄ‚îÄ current/          # –°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
‚îú‚îÄ‚îÄ releases/         # –í—Å–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ backup/           # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
‚îî‚îÄ‚îÄ repo/             # Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
```bash
sudo systemctl status splitkostya.service
```

### –õ–æ–≥–∏
```bash
sudo journalctl -u splitkostya.service -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx
```bash
sudo nginx -t
sudo systemctl status nginx
```

## –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions** –≤ GitHub
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow **CI/CD Pipeline**
3. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ **Run workflow**

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSH
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys` –Ω–∞ VPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ SSH –∫–ª—é—á—É (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 600)

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏
```bash
sudo chown -R www-data:www-data /var/www/splitKostya
sudo chmod -R 755 /var/www/splitKostya
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 3000 –Ω–µ –∑–∞–Ω—è—Ç
sudo netstat -tlnp | grep :3000

# –ï—Å–ª–∏ –∑–∞–Ω—è—Ç, –Ω–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
sudo lsof -i :3000
```

### –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
```bash
cd /var/www/splitKostya
sudo ln -sfn releases/YYYYMMDD-HHMMSS current
sudo systemctl restart splitkostya.service
```
